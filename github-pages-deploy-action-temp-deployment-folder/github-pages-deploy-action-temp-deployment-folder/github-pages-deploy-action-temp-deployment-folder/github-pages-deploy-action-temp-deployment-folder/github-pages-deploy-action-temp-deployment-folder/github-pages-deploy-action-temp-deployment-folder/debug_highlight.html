<!DOCTYPE html>
<html>
	<head>
		<title>Debug Highlighting Issue</title>
	</head>
	<body>
		<h1>Debug Country Highlighting</h1>
		<button onclick="testHighlighting()">Test Highlighting Logic</button>
		<div id="results"></div>

		<script>
			let countryData = {};

			async function loadData() {
				const response = await fetch("data/countryData.json");
				const data = await response.json();
				data.countries.forEach((country) => {
					countryData[country.ISO_A3] = country;
				});
				console.log(
					"Loaded country data for",
					Object.keys(countryData).length,
					"countries"
				);
			}

			async function testHighlighting() {
				await loadData();

				// Simulate a query result for "red flag" countries
				const queryResult = Object.values(countryData)
					.filter(
						(country) =>
							country.flagDescription &&
							country.flagDescription.toLowerCase().includes("red")
					)
					.slice(0, 10); // Take first 10 for testing

				console.log(
					"Query result:",
					queryResult.map((r) => `${r.name} (${r.ISO_A3})`)
				);

				// Simulate some map layers (mock geojson layer data)
				const mockLayers = [
					{ feature: { properties: { ISO_A3: "CHE", NAME: "Switzerland" } } },
					{ feature: { properties: { ISO_A3: "HUN", NAME: "Hungary" } } },
					{ feature: { properties: { ISO_A3: "GRD", NAME: "Grenada" } } },
					{ feature: { properties: { ISO_A3: "USA", NAME: "United States" } } },
					{
						feature: { properties: { ISO_A3: "XXX", NAME: "Unknown Country" } },
					},
				];

				// Test current highlighting logic
				console.log("\n=== Testing Current Logic (props && condition) ===");
				let highlightedCurrent = 0;
				mockLayers.forEach((layer) => {
					const iso = layer.feature.properties.ISO_A3;
					const props = countryData[iso];
					const condition = queryResult.some((result) => result.ISO_A3 === iso);
					const conditionResult = props && condition;

					console.log(
						`${iso}: hasProps=${!!props}, matchesQuery=${condition}, highlighted=${conditionResult}`
					);
					if (conditionResult) highlightedCurrent++;
				});

				// Test fixed logic
				console.log("\n=== Testing Fixed Logic (condition only) ===");
				let highlightedFixed = 0;
				mockLayers.forEach((layer) => {
					const iso = layer.feature.properties.ISO_A3;
					const props = countryData[iso];
					const condition = queryResult.some((result) => result.ISO_A3 === iso);

					console.log(
						`${iso}: hasProps=${!!props}, matchesQuery=${condition}, highlighted=${condition}`
					);
					if (condition) highlightedFixed++;
				});

				document.getElementById("results").innerHTML = `
                <h2>Results:</h2>
                <p>Query found ${
									queryResult.length
								} countries with red flags</p>
                <p>Current logic would highlight: ${highlightedCurrent} countries</p>
                <p>Fixed logic would highlight: ${highlightedFixed} countries</p>
                <h3>Test Countries:</h3>
                <ul>
                    ${mockLayers
											.map(
												(layer) =>
													`<li>${layer.feature.properties.NAME} (${
														layer.feature.properties.ISO_A3
													}) - Has data: ${!!countryData[
														layer.feature.properties.ISO_A3
													]}</li>`
											)
											.join("")}
                </ul>
            `;
			}
		</script>
	</body>
</html>
